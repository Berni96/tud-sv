
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>3.1 - Short Time Fourier Transformation &#8212; SV-book</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="2.2 - Linear Predictive Coding" href="../Thema-2-Messung%20der%20%C3%9Cbertragungsfunktion/2.2%20-%20LPC.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">SV-book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../Einf%C3%BChrung%20in%20Python/0.1%20-%20Installationsanleitung.html">
                    0.1 - Installationsanleitung
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Einführung in Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Einf%C3%BChrung%20in%20Python/0.2%20-%20Einf%C3%BChrung.html">
   0.2 - Einführung
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Thema-1-Filter
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Thema-1-Filter/1.1%20-%20FIR%20Filterentwurf.html">
   1.1 - FIR Filterentwurf
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Thema-1-Filter/1.2%20-%20IIR%20Filterentwurf.html">
   1.2 - IIR-Filterentwurf
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Thema-1-Filter/1.3%20-%20Anwendungsbeispiel.html">
   1.3 -  Anwendungsbeispiel
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Thema-2-Messung der Übertragungsfunktion
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Thema-2-Messung%20der%20%C3%9Cbertragungsfunktion/2.1%20-%20Sweep.html">
   2.1 - Sweep
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Thema-2-Messung%20der%20%C3%9Cbertragungsfunktion/2.2%20-%20LPC.html">
   2.2 - Linear Predictive Coding
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Thema-3-Analyse nichtstationärer Signale
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   3.1 - Short Time Fourier Transformation
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/Berni96/tud-sv/main?urlpath=tree/sv_book/Thema-3-Analyse nichtstationärer Signale/3.1 - STFT.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/Berni96/tud-sv"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/Berni96/tud-sv/issues/new?title=Issue%20on%20page%20%2FThema-3-Analyse nichtstationärer Signale/3.1 - STFT.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Thema-3-Analyse nichtstationärer Signale/3.1 - STFT.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inhalt">
   Inhalt
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references">
     References
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>3.1 - Short Time Fourier Transformation</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inhalt">
   Inhalt
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references">
     References
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="short-time-fourier-transformation">
<h1>3.1 - Short Time Fourier Transformation<a class="headerlink" href="#short-time-fourier-transformation" title="Permalink to this headline">#</a></h1>
<a class="reference internal image-reference" href="../_images/1-Titel.png"><img alt="../_images/1-Titel.png" src="../_images/1-Titel.png" style="width: 400px;" /></a>
<p>Die Kurzzeit-Fourier-Transformation (Englisch: “short-time-fourier-tranform”, kurz: STFT) ist eine Fourier-bezogene Transformation, mit der die Frequenzanteile und deren Phasenlage einzelner Zeitabschnitte eines Signals bestimmt werden. In der Praxis besteht das Verfahren zum Berechnen von STFTs darin, ein längeres Zeitsignal in kürzere Segmente gleicher Länge zu unterteilen und dann die Fourier-Transformation für jedes Segment separat zu berechnen. Die erzeugten Einzelspektren werden dann zur Analyse der spektralen Zusammensetzung über die Zeit in einem sog. <strong>Spektrogramm</strong> aneinandergefügt.</p>
<p>Dieses Notebook soll Ihnen die Theorie hinter der STFT näher bringen und mit Anwendungsbeispielen zeigen, wann diese Analysetechnik genutzt werden kann.</p>
<hr class="docutils" />
<p>Die Gliederung des Notebooks ist wie folgt aufgebaut:</p>
<ul class="simple">
<li><p>In <em>Abschnitt 1</em> werden einige Limitationen einer normalen Fouriertransformation bei instationären Signalen gezeigt.</p></li>
<li><p>In <em>Abschnitt 2</em> wird die Fensterung und dadurch Segmentierung von instationären Signalen durchgeführt und dessen Frequenzänge berechnet.</p></li>
<li><p>In <em>Abschnitt 3</em> werden diese einzelnen Frequenzgänge grafisch zusammengefügt und somit das besagte Spektrogram erzeugt.</p></li>
<li><p>Im letzten <em>Abschnitt 4</em> wird die STFT auf verschiedene Audio-Beispiele angewendet.</p></li>
</ul>
<section id="inhalt">
<h2>Inhalt<a class="headerlink" href="#inhalt" title="Permalink to this headline">#</a></h2>
<table style="width:256px; border: 1px solid black; display: inline-block">
    <tr>
        <td  style="text-align:right" width=64px><img src="img/1-1.png" style="float:left"></td>
        <td style="text-align:left" width=256px>
            <a style="color:black; font-size:12px; font-weight:bold; text-decoration:none" href='#1'>
                1. Nichtstationäre Signale
            </a>
        </td>
    </tr>  
    <tr>
        <td style="text-align:right"><img src="img/1-2.jpg" style="float:left"></td>
        <td style="text-align:left" width=128px>
            <a style="color:black; font-size:12px; font-weight:bold; text-decoration:none" href='#2'>
                2. Fensterung
            </a>
        </td>
    </tr>
    <tr>
        <td style="text-align:right"><img src="img/1-3.jpg" style="float:left"></td>
        <td style="text-align:left" width=128px>
            <a style="color:black; font-size:12px; font-weight:bold; text-decoration:none" href='#3'>
                3. Kurzzeitspektrum
            </a>
        </td>
    </tr>
    <tr>
        <td style="text-align:right"><img src="img/1-4.jpg" style="float:left"></td>
        <td style="text-align:left" width=128px>
            <a style="color:black; font-size:12px; font-weight:bold; text-decoration:none" href='#4'>
                4. Anwendungsbeispiele
            </a>
        </td>
    </tr>
</table>
<hr class="docutils" />
<p><a id='1'></a></p>
<div>
    <img src="img/1-1.png" style="float:left">
    <h2 style="position: relative; top: 6px; left: 6px">
        1. Nichtstationäre Signale 
    </h2>
</div>
<br>
<br>
Signale, die sich mit der Zeit ändern, werden als nichtstationäre Signale bezeichnet.
<p>Die Fourier-Transformation ist v.a. für stationäre Signale geeignet ist, deren spektrale Zusammensetzung (Frequenz und Phasenlage) sich zeitlich nicht ändert. In der Praxis sind die Signale jedoch häufig nichtstationäre Signale, wodurch diese Bedingung nicht mehr erfüllt ist. Wenn das Spektrum über eine einzige Fourier-Transformation bestimmt wird, gehen nicht nur spektrale Charakteristika verloren, sondern u.U. auch ihre zeitliche Zuordnung (d.h. <em>wann</em> die Frequenzkomponente im Zeitsignal auftritt). Daher müssen bei nicht stationären Signalen die lokalen Eigenschaften berücksichtigt werden. Das nichtperiodische Signal wird deswegen in zeitlich stationär angenommene Signalabschnitte unterteilt.</p>
<hr class="docutils" />
<p>Als Beispiel sollen zunächst einige Zeitsignale erzeugt und deren Frequenzgänge analysiert werden. Importieren Sie dafür zunächst alle für dieses Notebook notwendigen Module und installieren Sie gegebenfalls fehlende Module via <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">...</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Import externer Module</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="c1"># Installieren Sie numpy als np</span>
<span class="kn">import</span> <span class="nn">cmath</span>

<span class="kn">from</span>   <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="c1"># Importieren Sie fftpack und signal aus scipy in den globalen Namensraum</span>
<span class="kn">from</span>   <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="c1"># Importieren Sie wavfile aus scipy.io in den globalen Namensraum</span>

<span class="kn">import</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="c1"># Importieren Sie matplotlib.pyplot als plt</span>
<span class="kn">from</span>   <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="c1"># Importieren Sie cm aus matplotlib in den globalen Namensraum</span>

<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">axes3d</span>

<span class="kn">import</span> <span class="nn">librosa</span>
<span class="kn">import</span> <span class="nn">librosa.display</span>



<span class="kn">import</span> <span class="nn">IPython.display</span> <span class="k">as</span> <span class="nn">ipd</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">FloatSlider</span>
</pre></div>
</div>
</div>
</div>
<p>Falls verhindert werden soll, dass große Cell-Outputs (Plots, Interaktive Grafiken etc.) mit einem Scrollbar versehen werden, kann diese Zeile ausgeführt werden:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%javascript</span>
<span class="nx">IPython</span><span class="p">.</span><span class="nx">OutputArea</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_should_scroll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">lines</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>In diesem Notebook soll zudem das Konzept des <a class="reference external" href="https://realpython.com/python-dicts/">Dictionary</a> zur übersichtlichen Speicherung von Daten eingeführt werden. Ein Dictionary wird (vergleichbar mit Listen und Tupeln) mit geschweiften Klammern <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> erzeugt. Ein Dictionary speichert alle möglichen Datentypen, die man mit einem Schlüsselwort wieder aus diesem aufrufen kann. Die Syntax ist dabei wie folgt: <br>
{ Key_1: Value_1,<br>
Key_2: Value_2,<br>
… }<br><br>
Der Schlüssel muss dabei ein String (also <code class="docutils literal notranslate"><span class="pre">&quot;..&quot;</span></code> oder <code class="docutils literal notranslate"><span class="pre">'..'</span></code>) sein.</p>
<p>Als Beispiel sollen alle Informationen einer Audiodatei gespeichert werden. Diese kann beinhalten:</p>
<ul class="simple">
<li><p>Strings: Speicherort, Titel, Autor*in</p></li>
<li><p>Zahlen (float, int,..): Dauer, Abtastfrequenz</p></li>
<li><p>Listen bzw. Arrays… (auch Numpy-Array): Audiospur(en)</p></li>
<li><p>…</p></li>
</ul>
<p>Speichern Sie im Folgenden nun Ihr (vorgegebenes) Lieblingslied in ein Dictionary:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Erzeugen und Speichern von Dictionaries</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">author</span> <span class="o">=</span> <span class="s2">&quot;Wolfgang Petry&quot;</span>              <span class="c1"># Speichern Sie &#39;author&#39; unter dem Schlüssel &#39;Autor_in&#39; in dict_hit_no1</span>
<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Wahnsinn&#39;</span>                     <span class="c1"># Speichern Sie &#39;title&#39; unter dem Schlüssel &#39;Titel&#39; in dict_hit_no1</span>
<span class="n">duration_s</span> <span class="o">=</span> <span class="mf">319.25</span>                    <span class="c1"># Speichern Sie &#39;duration_s&#39; unter dem Schlüssel &#39;Spieldauer&#39; in dict_hit_no1</span>
<span class="n">fs_Hz</span> <span class="o">=</span> <span class="mi">44100</span>                          <span class="c1"># Speichern Sie &#39;fs_Hz&#39; unter dem Schlüssel &#39;Abtastfreq links&#39; in dict_hit_no1</span>
<span class="n">track_left</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.458</span><span class="p">,</span><span class="mf">0.23</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>        <span class="c1"># Speichern Sie &#39;track_left&#39; unter dem Schlüssel &#39;Spur links&#39; in dict_hit_no1</span>
<span class="n">track_right</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.02</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Speichern Sie &#39;track_right&#39; unter dem Schlüssel &#39;Spur rechts&#39; in dict_hit_no1</span>

<span class="n">dict_hit_no1</span> <span class="o">=</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="c1"># ToDo: erstellen sie das Dictionary</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Einträge im Dictionary: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_hit_no1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Um wieder an die in dem Dictionary gespeicherten Daten zu kommen, kann man diese auf zwei Weisen mit dem Schlüssel-bzw. Key-String aufrufen: <br>
<code class="docutils literal notranslate"><span class="pre">dict_hit_no1['key_string']</span></code> oder <code class="docutils literal notranslate"><span class="pre">dict_hit_no1.get('key_string')</span></code></p>
<p>Testen Sie beide Verfahren nun aus:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Laden von Daten aus Dictionaries</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="p">[</span><span class="o">..</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Um nun das angefangene Dictionary zu erweitern, kann dies mit dem Befehl <code class="docutils literal notranslate"><span class="pre">dict_XY.update(...)</span></code> erfolgen. Dabei kann man auch ein anderes Dictionary mit einfügen. Wenn sie einen Schlüssel nutzen, den es schon im Dictionary gab, werden die Daten überschrieben (nutzen Sie dies zur Aktualisierung der Daten).</p>
<p>Aktualisieren Sie nun das Dictionary Ihres Lieblingsliedes mit einem Genre und einer besseren Audiospur:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Erweiterung und Aktualisierung von Dictionaries</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">genre</span> <span class="o">=</span> <span class="s2">&quot;1a Kuschelrock&quot;</span>                       <span class="c1"># Speichern Sie &#39;genre&#39; unter dem Schlüssel &#39;Genre&#39; in dict_hit_no1</span>
<span class="n">track_left_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.458</span><span class="p">,</span><span class="mf">0.23</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>   <span class="c1"># Überschreiben Sie &#39;Spur links&#39; in dict_hit_no1</span>
<span class="n">track_right_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.02</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>      <span class="c1"># Überschreiben Sie &#39;Spur rechts&#39; in dict_hit_no1</span>
<span class="n">dict_better_version</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Spur links&#39;</span><span class="p">:</span> <span class="n">track_left_np</span><span class="p">,</span> <span class="s1">&#39;Spur rechts&#39;</span><span class="p">:</span> <span class="n">track_right_np</span><span class="p">}</span>

<span class="c1"># ToDo: Speichern Sie &#39;Genre&#39; ins Dictionary</span>
<span class="p">[</span><span class="o">..</span><span class="p">]</span>

<span class="c1"># ToDo: Updaten Sie das Unterdictionary &#39;dict_better_version&#39; in &#39;dict_hit_no1&#39;</span>
<span class="p">[</span><span class="o">..</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Einträge im Dictionary: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_hit_no1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Dictionaries können genutzt werden, um den Code übersichtlicher zu gestalten. Im Folgenden sollen jetzt mehrere instationäre Testsignale erzeugt werden, welche aus verschiedenen Sinusschwingungen zusammengesetzt sind.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Erzeugen von nichtstationären Signalen</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="c1"># Initialisierung der Variablen</span>
<span class="n">fs_Hz</span> <span class="o">=</span> <span class="mi">200</span>        <span class="c1"># Abtastfrequenz</span>
<span class="n">T_s</span> <span class="o">=</span> <span class="mi">6</span>            <span class="c1"># Zeitdauer</span>
<span class="n">L_periods</span> <span class="o">=</span> <span class="mi">10</span>     <span class="c1"># Länge des Signals in Perioden</span>

<span class="c1"># Vier Sinus-Signale</span>
<span class="n">f1_Hz</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="n">f2_Hz</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">f3_Hz</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
<span class="n">f4_Hz</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>

<span class="c1"># Vier Zeit-Segmente</span>
<span class="n">t1_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">f1_Hz</span><span class="o">*</span><span class="n">L_periods</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs_Hz</span><span class="p">);</span>
<span class="n">t2_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">([</span><span class="o">..</span><span class="p">]);</span>
<span class="n">t3_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">([</span><span class="o">..</span><span class="p">]);</span>
<span class="n">t4_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">([</span><span class="o">..</span><span class="p">]);</span>

<span class="c1"># Vier Sinus-Segmente</span>
<span class="n">seg1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">([</span><span class="o">..</span><span class="p">])</span> 
<span class="n">seg2</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">([</span><span class="o">..</span><span class="p">])</span> 
<span class="n">seg3</span> <span class="o">=</span> <span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">([</span><span class="o">..</span><span class="p">])</span> 
<span class="n">seg4</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">([</span><span class="o">..</span><span class="p">])</span> 


<span class="c1"># Drei verschiedene Signale mit unterschiedlichen Segmentzusammensetzungen</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">seg1</span><span class="p">,</span> <span class="n">seg2</span><span class="p">,</span> <span class="n">seg3</span><span class="p">,</span> <span class="n">seg4</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">seg3</span><span class="p">,</span> <span class="n">seg4</span><span class="p">,</span> <span class="n">seg2</span><span class="p">,</span> <span class="n">seg1</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">seg2</span><span class="p">,</span> <span class="n">seg1</span><span class="p">,</span> <span class="n">seg4</span><span class="p">,</span> <span class="n">seg3</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">t_s</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>  <span class="c1"># ToDo: Erzeugen Sie ein Array mit den zugehörigen Zeitschritten </span>


<span class="c1"># Initialisierung und füllen des Dictionaries:</span>
<span class="n">dict_s</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>  <span class="c1"># Speichern Sie die Signale &#39;s1&#39;, &#39;s2&#39; und &#39;s3&#39; mit Ihren Namen als Schlüssel in das &#39;dict_s&#39;</span>


<span class="c1"># Vorbereitung der Fouriertransformation</span>
<span class="n">signalLength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Länge des Signals: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">signalLength</span><span class="p">))</span>
<span class="n">Nfft</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">signalLength</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># Länge der Fft</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Länge der FFT: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nfft</span><span class="p">))</span>
<span class="n">f_Hz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fs_Hz</span><span class="p">,</span><span class="n">fs_Hz</span><span class="o">/</span><span class="n">Nfft</span><span class="p">)</span>   <span class="c1"># Frequenzachse</span>


<span class="n">dictIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="n">s3</span><span class="p">):</span>
    <span class="n">dictIndex</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="c1"># Transformation in den Frequenzbereich:</span>
    <span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>      <span class="c1"># ToDo: führen Sie eine FFT der Länge N mit dem Signal S durch. Nutzen Sie zB: fftpack.fft()</span>
    <span class="n">dict_s</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;S</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dictIndex</span><span class="p">)</span> <span class="p">:</span> <span class="n">S</span><span class="p">})</span>
    
    <span class="c1"># Graphische Darstellung</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Signal </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">dictIndex</span>)
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Zeit [s]&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;s(t)&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_s</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Frequenzgang des Signals </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">dictIndex</span>)
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequenz [Hz]&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;|S(f)|&#39;</span><span class="p">)</span> 
    <span class="n">Sabs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_Hz</span><span class="p">,</span> <span class="n">Sabs</span><span class="p">)</span>
    <span class="n">line1</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">f1_Hz</span><span class="p">,</span><span class="n">f1_Hz</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">Sabs</span><span class="p">)],</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;f=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f1_Hz</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
    <span class="n">line2</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">f2_Hz</span><span class="p">,</span><span class="n">f2_Hz</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">Sabs</span><span class="p">)],</span><span class="s1">&#39;-g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;f=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f2_Hz</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
    <span class="n">line3</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">f3_Hz</span><span class="p">,</span><span class="n">f3_Hz</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">Sabs</span><span class="p">)],</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;f=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f3_Hz</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
    <span class="n">line4</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">f4_Hz</span><span class="p">,</span><span class="n">f4_Hz</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">Sabs</span><span class="p">)],</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;f=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f4_Hz</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">line1</span><span class="p">,</span><span class="n">line2</span><span class="p">,</span><span class="n">line3</span><span class="p">,</span><span class="n">line4</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Phasengang des Signals </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">dictIndex</span>)
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequenz [Hz]&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs_Hz</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\phi$(f) [rad]&#39;</span><span class="p">)</span> 
    <span class="n">SPhase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_Hz</span><span class="p">,</span> <span class="n">SPhase</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Die absoluten Frequenzgänge $|S(f)|$ sind nahezu identisch und enthalten keine erkennbare Information mehr darüber, in welchem Segment welche harmonische Schwingung lag, während man die jeweiligen Amplitudenhöhen immer ungenauer werden, je kleiner die Signalabschnitte werden (durch die Wahl von $L_{periods}$).</p>
<p>Um alle Ergebnisse besser zu inspizieren, werden nun alle Ergebnisse über die <code class="docutils literal notranslate"><span class="pre">interact</span></code>- Funktion interaktiv dargestellt:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Interaktive Grafik</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="nd">@interact</span><span class="p">(</span> <span class="n">domain</span> <span class="o">=</span><span class="p">[(</span><span class="s1">&#39;1. Zeitsignal&#39;</span><span class="p">,</span> <span class="s1">&#39;s</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;2. Frequenzsignal&#39;</span><span class="p">,</span> <span class="s1">&#39;S</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)],</span> \
          <span class="n">signal1</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">signal2</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">signal3</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Realteil&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Imaginärteil&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Betrag&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Phase&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">)],</span> \
          <span class="n">lower_bound</span> <span class="o">=</span><span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="n">Nfft</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> \
          <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="n">Nfft</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">)</span>
<span class="k">def</span> <span class="nf">interactive_signals</span><span class="p">(</span><span class="n">domain</span> <span class="o">=</span> <span class="s1">&#39;Zeitsignal&#39;</span><span class="p">,</span> <span class="n">signal1</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">signal2</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">signal3</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> \
                             <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;abs&#39;</span><span class="p">,</span> <span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">Nfft</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">col</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">legend_label</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">signal1</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">legend_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Segment 1&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">signal2</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="n">legend_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Segment 2&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">signal3</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span> 
        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">legend_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Segment 3&#39;</span><span class="p">)</span>
    
    <span class="n">m</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>   
        <span class="n">s</span> <span class="o">=</span> <span class="n">m</span>
    

    <span class="c1"># Grafische Darstellung</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">legend_label</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><a id='2'></a></p>
<div>
    <img src="img/1-2.jpg" style="float:left">
    <h2 style="position: relative; top: 6px; left: 6px">
        2. Fensterung  
    </h2>
</div>
<br>
<br>
Im folgenden Abschnitt soll die Fensterung näher betrachtet werden, mit der das nichtstationäre Signal in quasi-stationäre Signalabschnitte segmentiert wird.
<p>Ein bloßes Ausschneiden des Signals würde nicht nur potentiell Sprünge im periodisch forgesetzten Zeitsignal erzeugen, was bereits in Notebook 2.2 thematisiert wurde, sondern ist auch gleichbedeutend mit einer Rechteckfensterung. Anders formuliert ist das einfache Ausschneiden eines Signalabschnittes gleichbedeutend mit der Multiplikation mit einem Rechteckfenster im Zeitbereich, welches einer Faltung mit einer Spaltfunktion im Frequenzbereich und dadurch ein Verwischen der Spektrallinien zur Folge hat. Deshalb ist es wichtig, eine geeignetere Fensterfunktion $h(t)$ zu wählen (z.B. ein von-Hann-Fenster). Die Fensterlänge $T$ wird entsprechend der Länge des quasi-periodischen Signalsegments gewählt.
Ein weiterer Parameter ist der Grad der Überlappung aufeinanderfolgender Signalabschnitte (siehe Vorlesung Thema4, Folie 15 ff.).</p>
<hr class="docutils" />
<p>Nutzen Sie die vorgegebene Funktion <code class="docutils literal notranslate"><span class="pre">live_plot()</span></code>, um sich einen Durchlauf der Segmentierung, Fensterung und Fouriertransformation auf das Signal <code class="docutils literal notranslate"><span class="pre">s1</span></code> anschauen zu können. Durch den Aufruf von <code class="docutils literal notranslate"><span class="pre">ipd.clear_output()</span></code> wird der vorherige Plot gelöscht, auf dessen Stelle ein neuer Plot eingefügt wird.
(Anmerkung: für richtige Animationen von Plots bietet sich auch die <a class="reference external" href="https://matplotlib.org/api/animation_api.html">animation</a> API von Matplotlib an. Da dies aber nicht der Inhalt dieses Notebooks ist, soll die Animation simpel gehalten werden).
Die Funktionsargumente sind</p>
<ul class="simple">
<li><p>die Zeitachse <code class="docutils literal notranslate"><span class="pre">t_s</span></code></p></li>
<li><p>das Audiosignal <code class="docutils literal notranslate"><span class="pre">audioSignal</span></code></p></li>
<li><p>die Zeitachse eines gefensterten Signalausschnittes <code class="docutils literal notranslate"><span class="pre">tSegment_s</span></code></p></li>
<li><p>der gefensterte Signalausschnitt <code class="docutils literal notranslate"><span class="pre">winAudioSignalSegment</span></code></p></li>
<li><p>die Frequenzachse des Spektrums <code class="docutils literal notranslate"><span class="pre">fSegment_Hz</span></code></p></li>
<li><p>das Spektrum selbst <code class="docutils literal notranslate"><span class="pre">SSegment</span></code></p></li>
<li><p>der Schritt, an dem sich das Spektrogramm gerade befindet <code class="docutils literal notranslate"><span class="pre">stepIndex</span></code></p></li>
<li><p>Limits für die Achsen <code class="docutils literal notranslate"><span class="pre">xLim_max</span></code>&amp; <code class="docutils literal notranslate"><span class="pre">yLim_max</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Funktion definieren: Dynamische Darstellung</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="k">def</span> <span class="nf">live_plot</span><span class="p">(</span><span class="n">t_s</span><span class="p">,</span> <span class="n">audioSignal</span><span class="p">,</span> <span class="n">tSegment_s</span><span class="p">,</span> <span class="n">winAudioSignalSegment</span><span class="p">,</span> <span class="n">fSegment_Hz</span><span class="p">,</span> <span class="n">SSegment</span><span class="p">,</span>\
              <span class="n">stepIndex</span><span class="p">,</span> <span class="n">xLim_max</span><span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">yLim_max</span><span class="o">=</span> <span class="mi">80</span><span class="p">):</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
    <span class="n">ipd</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fensterung des Signals&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Zeit [s]&#39;</span><span class="p">)</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;s(t)&#39;</span><span class="p">)</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_s</span><span class="p">,</span> <span class="n">audioSignal</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tSegment_s</span><span class="p">,</span> <span class="n">winAudioSignalSegment</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Frequenzgang des gefensterten Signalsegments </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">stepIndex</span>)
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequenz [Hz]&#39;</span><span class="p">)</span> 
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;|S(f)|&#39;</span><span class="p">)</span> 
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fSegment_Hz</span><span class="p">,</span> <span class="n">SSegment</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xLim_max</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">yLim_max</span><span class="p">)</span>    
    
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>Normalisieren Sie zunächst das Signal <code class="docutils literal notranslate"><span class="pre">s1</span></code>, dass dessen Maximalwert den Wert 1 beträgt.</p></li>
<li><p>Erzeugen Sie ein <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.get_window.html">Tukey-Fenster</a> mit einem alpha-Parameter von 0.7, dessen Fensterlänge <code class="docutils literal notranslate"><span class="pre">T_samples</span></code> $2^x$ Samples beträgt (z.B. $x=7$ für 128 samples). Dies soll auch die Länge der FFT sein.</p></li>
<li><p>Stellen Sie eine Überlappung des Zeitfensters <code class="docutils literal notranslate"><span class="pre">overlap_samples</span></code> auf die Hälfte oder zwei Drittel der Fensterlänge <code class="docutils literal notranslate"><span class="pre">Twin_samples</span></code> ein. Die Überlappung und der Vorschub zweier Fenster sind voneiander abhängig: Anzahl an Segmenten = (Fensterlänge - Overlap)/Vorschub (Vorschub ist hier als <code class="docutils literal notranslate"><span class="pre">slide_samples</span></code> bezeichnet).</p></li>
<li><p>Erzeugen Sie eine for-Schleife, in welcher jedes Segment gefenstert und Fourier-transformiert wird. Achten Sie dabei darauf, dass die Schleife bei Erreichen des Signalendes korrekt beendet wird und nicht auf Indices außerhalb des Arrays zugegriffen wird. Berechnen Sie daher vorher die Anzahl an möglichen Segmenten (<code class="docutils literal notranslate"><span class="pre">numSegments</span></code>).</p></li>
<li><p>Fügen Sie zum Schluss die Funktion <code class="docutils literal notranslate"><span class="pre">live_plot</span></code> in die for-Schleife ein und übergeben Sie diesem die benötigten Parameter und Werte.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Dynamische Fensterung des Signals &#39;s1&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># Signal s1 normalisieren</span>
<span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>         <span class="c1"># ToDo: Signal &#39;s1&#39; aus dict_s normalisieren</span>
<span class="n">T_samples</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="c1"># ToDo: Anzahl an Abtastpunkten</span>
<span class="n">T_s</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>       <span class="c1"># ToDo: Zeitdauer des Gesamtsignals</span>
<span class="n">t_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T_s</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs_Hz</span><span class="p">)</span>


<span class="c1"># Erzeugung des Fensters</span>
<span class="n">Nfft</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">7</span><span class="p">;</span>                       <span class="c1"># FFT Länge</span>
<span class="n">Twin_samples</span> <span class="o">=</span> <span class="n">Nfft</span>                <span class="c1"># Fensterlänge in samples</span>
<span class="n">overlap_samples</span> <span class="o">=</span> <span class="n">Twin_samples</span><span class="o">//</span><span class="mi">4</span>  <span class="c1"># Überlappung zwischen zwei Segmenten</span>
<span class="n">slide_sample</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>                <span class="c1"># ToDo: Legen Sie den Vorschub des Fensters (abhängig von &quot;Twin Samples&quot; und &quot;overlap_samples&quot;) fest</span>
<span class="n">window</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>                      <span class="c1"># ToDo: Erzeugen Sie das Tukey-Fenster mit &#39;signal.get_window()&#39;</span>
<span class="n">f_Hz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs_Hz</span><span class="p">,</span> <span class="n">fs_Hz</span><span class="o">/</span><span class="n">Nfft</span><span class="p">)</span>


<span class="c1"># Erzeugung des Segments, Fouriertransformation dessen und graphische Anzeige</span>
<span class="n">numSegments</span> <span class="o">=</span> <span class="p">(</span><span class="n">T_samples</span> <span class="o">-</span> <span class="n">overlap_samples</span><span class="p">)</span><span class="o">//</span><span class="n">slide_sample</span>

<span class="c1"># Überprüfung der Parameter:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Länge des Signals: </span><span class="si">{}</span><span class="s2"> samples&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">T_samples</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fenster/FFT Länge: </span><span class="si">{}</span><span class="s2"> samples&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Twin_samples</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vorschub: </span><span class="si">{}</span><span class="s2"> samples&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">overlap_samples</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Anzahl an Segmenten: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numSegments</span><span class="p">))</span>


<span class="k">for</span> <span class="n">seqIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSegments</span><span class="p">):</span>
    <span class="n">tSegment_s</span> <span class="o">=</span> <span class="n">t_s</span><span class="p">[</span><span class="n">seqIndex</span><span class="o">*</span><span class="n">slide_sample</span><span class="p">:</span> <span class="n">seqIndex</span><span class="o">*</span><span class="n">slide_sample</span> <span class="o">+</span> <span class="n">Twin_samples</span><span class="p">]</span>
    <span class="n">sSegment</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">seqIndex</span><span class="o">*</span><span class="n">slide_sample</span><span class="p">:</span> <span class="n">seqIndex</span><span class="o">*</span><span class="n">slide_sample</span> <span class="o">+</span> <span class="n">Twin_samples</span><span class="p">]</span>
    <span class="n">winsSegment</span> <span class="o">=</span> <span class="n">sSegment</span> <span class="o">*</span> <span class="n">window</span>
    <span class="n">winS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fftpack</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">winsSegment</span><span class="p">,</span> <span class="n">Nfft</span><span class="p">))</span>       
    
    <span class="c1"># Graphische Darstellung</span>
    <span class="p">[</span><span class="o">..</span><span class="p">]</span>      <span class="c1"># ToDo: Fügen Sie die Funktion &#39;live_plot()&#39; ein (xLim_max=50, yLim_max=90)</span>
</pre></div>
</div>
</div>
</div>
<p>Die Wahl der Fensterfunktion $h(t)$ und der Zeitfensterlänge <code class="docutils literal notranslate"><span class="pre">Twin_samples</span></code> muss problemspezifisch erfolgen. Im Allgemeinen kann ein kurzes Zeitfenster eine höhere Auflösung des zeitlichen Zustands und ein langes Fenster eine höhere Auflösung im Frequenzbereich bieten. Zwischen beidem muss der beste Kompromiss gesucht werden.</p>
<hr class="docutils" />
<p><a id='3'></a></p>
<div>
    <img src="img/1-3.jpg" style="float:left">
    <h2 style="position: relative; top: 6px; left: 6px">
        3. Kurzzeitspektrum  
    </h2>
</div>
<br>
<br>
Setzt man den Signalabschnitt als zu transformierende Funktion in das Fourier-Integral ein, erhält man die Hintransformationsgleichung der STFT wie folgt:
\begin{equation}
X(\omega, t)=\int_{-\infty}^{\infty}x(\tau)h(t-\tau)e^{-j\omega \tau}d\tau 
\end{equation} 
Das dabei entstehende Spektrum hat außer der Kreisfrequenz $\omega$ nun auch noch den Analysezeitpunkt $t$ als Variable. Da gewöhnlich voraussetzt wird, dass die Zeitfensterlänge $T$ endlich ist, können die Integrationsgrenzen entsprechend eingeengt werden.  
<p>Zur Berechnung der STFT können direkt Funktionen aus installierten Bibliotheken genutzt werden. Hier sollen die Funktionen <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.stft.html">signal.stft()</a> und <a class="reference external" href="https://librosa.org/doc/0.8.0/generated/librosa.stft.html">librosa.stft()</a> genutzt werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Spektrogramm mit scipy.signal.stft()</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Zxx</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">dict_s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;s</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs_Hz</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;tukey&#39;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span><span class="n">nperseg</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>  <span class="c1"># Frequenzgänge</span>
    <span class="n">dict_s</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;s</span><span class="si">{}</span><span class="s1">_scipy_stft&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Zxx</span><span class="p">)})</span>
    
    <span class="c1"># Grafische Darstellung:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Zxx</span><span class="p">),</span> <span class="n">shading</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;STFT Magnitude des Signals </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">i</span>)
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Zeit [s]&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequenz [Hz]&#39;</span><span class="p">)</span>   
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Durch die Darstellung der Signale im Spektrogramm wird nun aus dem Amplitudenfrequenzgang deutlich klarer, welche Frequenzelemente sich in welchen Zeitabschnitten befinden. Über die Fensterlänge <code class="docutils literal notranslate"><span class="pre">nperseq</span></code> lässt sich die Frequenzauflösung auf Kosten der Zeitauflösung verbessern. Wird <code class="docutils literal notranslate"><span class="pre">nperseq</span></code> klein genug gewählt (z.B. = 50), wird sogar sogar die Periodizität des Zeitsignals sichtbar. Die Frequenzauflösung ist in diesem Falle dann aber sehr grob.</p>
<p>Alternativ kann das Spektrogramm mit den Funktionen <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.spectrogram.html">signal.spectrogram()</a> oder <a class="reference external" href="https://librosa.org/doc/main/generated/librosa.display.specshow.html">librosa.display.specshow()</a> berechnet werden. Beide Funktionen sollten identische Ergebnisse liefern, lediglich standard colormap ist unterschiedlich.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Spektrogramm mit librosa.stft()</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">windowLength</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">librosa</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">dict_s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span> <span class="n">n_fft</span><span class="o">=</span><span class="n">windowLength</span><span class="p">,</span> \
                            <span class="n">win_length</span><span class="o">=</span><span class="n">windowLength</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;tukey&#39;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)))</span> 

    <span class="c1"># (Optional) in dB konvertieren:</span>
    <span class="c1"># S_dB = librosa.amplitude_to_db(S)     </span>
    
    <span class="c1"># Graphische Darstellung</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="n">librosa</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">specshow</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">fs_Hz</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">y_axis</span><span class="o">=</span><span class="s1">&#39;hz&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Spektrogramm des Signals </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">i</span>)
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Zeit [s]&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequenz [Hz]&#39;</span><span class="p">)</span>  
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Das Spektrogramm kann auch dreidimensional geplottet werden:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3D-Visualisierung</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="k">for</span> <span class="n">plotIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">f_Hz</span><span class="p">,</span> <span class="n">t_s</span><span class="p">,</span> <span class="n">magnitude</span> <span class="o">=</span> <span class="n">dict_s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;s</span><span class="si">{}</span><span class="s1">_scipy_stft&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plotIndex</span><span class="p">))</span> <span class="c1"># STFT </span>
    <span class="n">fLimits_Hz</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f</span><span class="o">&lt;</span><span class="mi">50</span><span class="p">)</span> <span class="c1"># Frequenzgrenze</span>
    <span class="n">f_Hz</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">fLimits_Hz</span><span class="p">]</span>        <span class="c1"># Frequenzbereich</span>
    <span class="n">magnitude</span> <span class="o">=</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">fLimit</span><span class="p">]</span>
    
    <span class="c1"># Graphische Darstellung</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">plotIndex</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;3D-Visualisierung des Signals </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">plotIndex</span>)
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Zeit [s]&#39;</span><span class="p">)</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequenz [Hz]&#39;</span><span class="p">)</span>  
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>  
    <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">f_Hz</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">magnitude</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">cool</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><a id='4'></a></p>
<div>
    <img src="img/1-4.jpg" style="float:left">
    <h2 style="position: relative; top: 6px; left: 6px">
        4. Anwendungsbeispiele  
    </h2>
</div>
<br><br>
Für die STFT gibt es viele Anwendungsmöglichkeiten, wie zum Beispiel für die Analyse von Sprache. In diesem Abschnitt soll die STFT zur Analyse von Musiksignalen verwenden. Dazu soll zunächst eine Funktion definiert werden, mit der Informationen aus einer .wav-Datei importiert und als Dictionary abgespeichert werden können.
<p>Ergänzen Sie die Leerstellen [..] :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Funktion definieren: wav-Datei laden</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="k">def</span> <span class="nf">wav_data</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
    
    <span class="n">fs_Hz</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="p">)</span>                 <span class="c1"># Abtrastfrequenz, Signal</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>                                  <span class="c1"># Linken Kanal speichern </span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>                         <span class="c1"># Signal normalisieren </span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>                                        <span class="c1"># Signal-Länge</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">L</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>            <span class="c1"># FFT-Länge</span>
    <span class="n">T_s</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>                                      <span class="c1"># Zeitdauer</span>
    <span class="n">t_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="p">)</span>                       <span class="c1"># Zeitbereich</span>
    <span class="n">f_Hz</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>                                     <span class="c1"># Frequenzbereich</span>
    
    <span class="c1"># alle benötige Daten in Dictionary speichern</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;signal&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;fs_Hz&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;signalLength&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;fftLength&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;t_s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;f_Hz&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="p">}</span>
                                                    
    <span class="k">return</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p><strong>Beispiel 1: missing fundamental / Die fehlende Grundfrequenz</strong></p>
<p>Unsere Wahrnehmung von Akustik wird nicht nur von den einzelnen Frequenzkoponenten innerhalb eines Tons bestimmt, sondern u.a. auch von den Abständen der Obertöne/Harmonischen zueinandner. Dies führt zu einem interessanten Phänomen des sog. “Residualtons” (im Englischen etwas treffender “missing fundamental”), bei dem zwei Töne, von denen einer keine (oder nur eine sehr gering ausgeprägte) Grundfrequenz aufweist, trotzdem sehr ähnlich klingend wahrgenommen werden.</p>
<p>Laden sie dazu die beiden Audiodateien <code class="docutils literal notranslate"><span class="pre">toneF.wav</span></code> und <code class="docutils literal notranslate"><span class="pre">toneF_noFund.wav</span></code> ein, anhand dieser Effekt demonstriert werden soll.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">toneF.wav laden und abspielen</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;data/toneF.wav&#39;</span>
<span class="c1"># Laden von toneF mit dem Namen &#39;Ton F&#39;</span>
<span class="n">toneF</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="c1"># ToDo: Nutzen Sie die Funktion &#39;wav_data&#39;, um die .wav in das Projekt zu laden </span>
<span class="c1"># Akustische Ausgabe</span>
<span class="n">ipd</span><span class="o">.</span><span class="n">Audio</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>                   
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">toneF_noFund.wav laden und abspielen</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;data/toneF_noFund.wav&#39;</span>
<span class="c1"># Laden von toneF_noFund mit dem Namen &#39;Ton F ohne Fundament&#39;</span>
<span class="n">toneF_noFund</span> <span class="o">=</span>  <span class="c1"># ToDo: Nutzen Sie die Funktion &#39;wav_data&#39;, um die .wav in das Projekt zu laden</span>
<span class="c1"># Akustische Ausgabe</span>
<span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="c1"># ToDo</span>
</pre></div>
</div>
</div>
</div>
<p>Beide Töne sollten relativ ähnlich klingen, vor allem von der wahrgenommenen Tonhöhe. Ein Blick auf das Spektrogramm verrät aber, dass im zweiten Falle die Grundfrequenz fehlt. Erstellen Sie dazu das Spektrogramm beider Audiosignale mit librosa. Skalieren Sie die Frequenzachse logarithmisch (<a class="reference external" href="http://man.hubwiz.com/docset/LibROSA.docset/Contents/Resources/Documents/generated/librosa.core.amplitude_to_db.html">librosa.amplitude_to_db()</a>) Um die Frequenzkomponenten klarer darzustellen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">toneF und toneF_NoFund über Spektrogramm darstellen</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">tone</span> <span class="ow">in</span> <span class="p">(</span><span class="n">toneF</span><span class="p">,</span> <span class="n">toneF_noFund</span><span class="p">):</span>

    <span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>    <span class="c1"># ToDo: Wenden Sie die Funktion &#39;librosa.stft()&#39; auf das Signal &#39;tone[&#39;signal&#39;]&#39; an</span>
    <span class="n">S_dB</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">amplitude_to_db</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>     <span class="c1"># in dB konvertieren</span>
    
    <span class="c1"># Graphische Darstellung</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">librosa</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">specshow</span><span class="p">(</span><span class="n">S_dB</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">tone</span><span class="p">[</span><span class="s1">&#39;fs_Hz&#39;</span><span class="p">],</span> <span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">y_axis</span><span class="o">=</span><span class="s1">&#39;hz&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gist_heat</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Spektrogramm von </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">tone</span>[&#39;name&#39;])
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Zeit [s]&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequenz [Hz]&#39;</span><span class="p">)</span>  
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1500</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p><strong>Beispiel 2: Melodie aus verschiedenen Instrumenten</strong></p>
<p>Als ein weiteres Beispiel für die Nützlichkeit von Spektrogrammen sollen die beiden Audiodateien <code class="docutils literal notranslate"><span class="pre">melodie_klavier.wav</span></code>, <code class="docutils literal notranslate"><span class="pre">melodie_geige.wav</span></code> sowie <code class="docutils literal notranslate"><span class="pre">melodie_stimme.wav</span></code> untersucht werden. Laden Sie diese ein. Die Signale stellen dieselbe Melodie dar, aber mit unterschiedlichen Instrumenten bzw. gesungen (Vocoder).</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">melodie_klavier.wav laden und abspielen</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;data/melodie_klavier.wav&#39;</span>
<span class="n">melodyPiano</span> <span class="o">=</span> <span class="n">wav_data</span><span class="p">(</span><span class="s1">&#39;Klaviermelodie&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
<span class="n">ipd</span><span class="o">.</span><span class="n">Audio</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>                       
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">melodie_geige.wav laden und abspielen</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;data/melodie_geige.wav&#39;</span>
<span class="n">melodyViolin</span> <span class="o">=</span> <span class="n">wav_data</span><span class="p">(</span><span class="s1">&#39;Geigemelodie&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
<span class="n">ipd</span><span class="o">.</span><span class="n">Audio</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>                       
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">melodie_stimme.wav laden und abspielen</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;data/melodie_stimme.wav&#39;</span>
<span class="n">melodyVoice</span> <span class="o">=</span> <span class="n">wav_data</span><span class="p">(</span><span class="s1">&#39;Stimme&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
<span class="n">ipd</span><span class="o">.</span><span class="n">Audio</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>                       
</pre></div>
</div>
</div>
</div>
<p>Stellen Sie nur das Spektrogramm zur Analyse der drei Signale dar. Varrieren Sie FFT Länge, Fenstertyp und Überlappung (Achtung, der Grad der Überlappung wird in Anzahl an Abtastwerten abgegeben, nach welchen sich die Fensterung wiederholt, nicht relativ zur FFT Länge).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Kurzzeitspektrum</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">numSamplesPerSegment</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">numSamplesOverlap</span> <span class="o">=</span> <span class="n">numSamplesPerSegment</span><span class="o">/</span><span class="mi">4</span>

<span class="n">plotIndex</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">melody</span> <span class="ow">in</span> <span class="p">(</span><span class="n">melodyPiano</span><span class="p">,</span> <span class="n">melodyViolin</span><span class="p">,</span> <span class="n">melodyVoice</span><span class="p">):</span>
    
    <span class="n">plotIndex</span> <span class="o">+=</span> <span class="mi">1</span> 
    <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">magnitude</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>  <span class="c1"># ToDo: Wenden Sie die Funktion &#39;signal.stft()&#39; auf das Signal &#39;melody&#39; an</span>
    
    <span class="c1"># Graphische Darstellung</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">plotIndex</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t_s</span><span class="p">,</span> <span class="n">f_Hz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">magnitude</span><span class="p">),</span> <span class="n">shading</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;STFT Magnitude der </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">melody</span>[&#39;name&#39;])
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Zeit [s]&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequenz [Hz]&#39;</span><span class="p">)</span>   
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Kurzzeitspektrum</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">numSamplesPerSegment</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">numSamplesOverlap</span> <span class="o">=</span> <span class="n">numSamplesPerSegment</span><span class="o">/</span><span class="mi">4</span>

<span class="c1">#Lösung</span>
<span class="n">plotIndex</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">melody</span> <span class="ow">in</span> <span class="p">(</span><span class="n">melodyPiano</span><span class="p">,</span> <span class="n">melodyViolin</span><span class="p">,</span> <span class="n">melodyVoice</span><span class="p">):</span>
    
    <span class="n">plotIndex</span> <span class="o">+=</span> <span class="mi">1</span> 
    <span class="n">f_Hz</span><span class="p">,</span> <span class="n">t_s</span><span class="p">,</span> <span class="n">magnitude</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">melody</span><span class="p">[</span><span class="s1">&#39;signal&#39;</span><span class="p">],</span> <span class="n">melody</span><span class="p">[</span><span class="s1">&#39;fs_Hz&#39;</span><span class="p">],</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hann&#39;</span><span class="p">,</span> \
                            <span class="n">nperseg</span><span class="o">=</span><span class="n">numSamplesPerSegment</span><span class="p">,</span> <span class="n">noverlap</span><span class="o">=</span><span class="n">numSamplesOverlap</span><span class="p">)</span> 
    
    <span class="c1"># Graphische Darstellung</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">plotIndex</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">t_s</span><span class="p">,</span> <span class="n">f_Hz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">magnitude</span><span class="p">),</span> <span class="n">shading</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;STFT Magnitude der </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">melody</span>[&#39;name&#39;])
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Zeit [s]&#39;</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequenz [Hz]&#39;</span><span class="p">)</span>   
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Wie im Spektrogramm gut zu sehen ist, sind die Töne der einzelnen Instrumente aus einer Grundfrequenz und mehreren Harmonischen aufgebaut, die immer Vielfache der Grundfrequenz sind. Die höherfrequenten Beiträge dieser “Obertöne” lassen verschiedene Musikinstrumente unterschiedlich klingen.</p>
<ul class="simple">
<li><p><strong>Beispiel 3: Spektrogramm vs. Musiknoten</strong></p></li>
</ul>
<p>Nun analysieren Sie bitte anhand der nun kennengelernten Verfahren das Audiosignal von <code class="docutils literal notranslate"><span class="pre">musik.wav</span></code>[9]:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">musik.wav laden und abspielen</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;data/musik.wav&#39;</span>
<span class="c1"># Laden von musik.wav mit dem Namen &#39;Musiksignal&#39;</span>
<span class="n">music</span> <span class="o">=</span> <span class="c1"># ToDo: Nutzen Sie die Funktion &#39;wav_data&#39;, um die .wav mit dem Namen &#39;Musikdatei&#39; in das Projekt zu laden. </span>
<span class="c1"># Akustische Ausgabe</span>
<span class="p">[</span><span class="o">..</span><span class="p">]</span>                       
</pre></div>
</div>
</div>
</div>
<p>Führen Sie zunächst eine dynamische Fensterung (wie in Abschnitt 2) mit folgenden Eigenschaften durch,</p>
<ul class="simple">
<li><p>Zeitfenstertyp: Blackman,</p></li>
<li><p>Zeitfensterlänge: $2^{14}$ Samples,</p></li>
<li><p>Vorschub: 50 % der Fensterlänge,</p></li>
</ul>
<p>um noch eimal den Prozess der Erstellung des Spektrogramms zu visualisieren (die Fensterlänge von $2^{14} = 16384$ Samples ist relativ groß und wird nur für diese Visualisierung gewählt, damit das Plotten nicht zu lange dauert). Gehen sie dabei wie in Abschnitt 2 vor. Ggf. können Sie die Routine zur Berechnung der Zeitversetzung, Fensterung und Fouriertransformation der Signalabschnitte auch als eigene Funktion kapseln.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Aufgabe: Dynamische Fensterung darstellen</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># Signal importieren und normalisieren</span>
<span class="n">audioSignal</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="c1"># Audiosignal normieren</span>
<span class="n">fs_Hz</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>
<span class="n">T_samples</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>
<span class="n">T_s</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>
<span class="n">t_s</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>


<span class="c1"># Erzeugung des Zeitfensters</span>
<span class="n">Nfft</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">14</span><span class="p">;</span>                         <span class="c1"># FFT Länge</span>
<span class="n">Twin_samples</span> <span class="o">=</span> <span class="n">Nfft</span>                   <span class="c1"># Fensterlänge in samples</span>
<span class="n">overlap_samples</span> <span class="o">=</span> <span class="n">Twin_samples</span><span class="o">//</span><span class="mi">4</span>     <span class="c1"># Überlappung zwischen zwei Segmenten                         </span>
<span class="n">slide_samples</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>                  <span class="c1"># Vorschub eines Abschnittes pro Segment</span>
<span class="n">window</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>                         <span class="c1"># Blackman-Fenster</span>
<span class="n">f_Hz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs_Hz</span><span class="p">,</span> <span class="n">fs_Hz</span><span class="o">/</span><span class="n">Nfft</span><span class="p">)</span>

<span class="c1"># Erzeugung des Segments, Fouriertransformation dessen und grafische Anzeige:</span>
<span class="n">numSegments</span> <span class="o">=</span> <span class="p">(</span><span class="n">T_samples</span> <span class="o">-</span> <span class="n">overlap_samples</span><span class="p">)</span><span class="o">//</span><span class="n">slide_samples</span>

<span class="k">for</span> <span class="n">seqIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSegments</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Segment </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">seqIndex</span><span class="p">))</span>
    <span class="n">tSegment_s</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>
    <span class="n">sSegment</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>
    <span class="c1"># Fenstern</span>
    <span class="n">winsSegment</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>
    <span class="c1"># Fouriertransformation</span>
    <span class="n">winS</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span>

    <span class="c1"># Grafische Darstellung:</span>
    <span class="p">[</span><span class="o">..</span><span class="p">]</span>      <span class="c1"># ToDo: Fügen Sie die Funktion &#39;live_plot()&#39; ein (xLim_max=fs_Hz/10, yLim_max=0.1)</span>
</pre></div>
</div>
</div>
</div>
<p>Auch hier lohnt die Darstellung des kurzen Musikabschnittes als Spektrogramm. Variieren Sie die Parameter wie Fenstertyp, Überlappung, Fensterlänge usw.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Aufgabe: Spektrogramm darstellen</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="o">..</span><span class="p">]</span> <span class="c1"># ToDo: Führen Sie eine STFT des Signal music[&#39;signal&#39;] mit librosa.stft() durch</span>
<span class="n">S_dB</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">amplitude_to_db</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>     
<span class="n">T_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">S_dB</span><span class="p">)</span>

<span class="c1"># Einige interessante Frequenzen:</span>
<span class="n">f1_Hz</span> <span class="o">=</span> <span class="mi">700</span>
<span class="n">f2_Hz</span> <span class="o">=</span> <span class="mi">950</span>
<span class="n">f3_Hz</span> <span class="o">=</span> <span class="mi">1050</span>

<span class="c1"># Grafische Darstellung:</span>
<span class="n">librosa</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">specshow</span><span class="p">(</span><span class="n">S_dB</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">music</span><span class="p">[</span><span class="s1">&#39;fs_Hz&#39;</span><span class="p">],</span> <span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">y_axis</span><span class="o">=</span><span class="s1">&#39;hz&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">bwr</span><span class="p">)</span>
<span class="n">freqLine1</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T_samples</span><span class="p">],[</span><span class="n">f1_Hz</span><span class="p">,</span> <span class="n">f1_Hz</span><span class="p">],</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;f1_Hz=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f1_Hz</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
<span class="n">freqLine2</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T_samples</span><span class="p">],[</span><span class="n">f2_Hz</span><span class="p">,</span> <span class="n">f2_Hz</span><span class="p">],</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;f2_Hz=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f2_Hz</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
<span class="n">freqLine3</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T_samples</span><span class="p">],[</span><span class="n">f3_Hz</span><span class="p">,</span> <span class="n">f3_Hz</span><span class="p">],</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;f3_Hz=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f3_Hz</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Spektrogramm des Musiksignals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Zeit [s]&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequenz [Hz]&#39;</span><span class="p">)</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1500</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">freqLine1</span><span class="p">,</span> <span class="n">freqLine2</span><span class="p">,</span> <span class="n">freqLine3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Aufgabe: Spektrogramm darstellen</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># Lösung</span>
<span class="n">S</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">librosa</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">music</span><span class="p">[</span><span class="s1">&#39;signal&#39;</span><span class="p">],</span> <span class="n">win_length</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">))</span>
<span class="n">S_dB</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">amplitude_to_db</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>     
<span class="n">T_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">S_dB</span><span class="p">)</span>
<span class="c1"># Einige interessante Frequenzen:</span>
<span class="n">f1_Hz</span> <span class="o">=</span> <span class="mi">700</span>
<span class="n">f2_Hz</span> <span class="o">=</span> <span class="mi">950</span>
<span class="n">f3_Hz</span> <span class="o">=</span> <span class="mi">1050</span>

<span class="c1"># Grafische Darstellung:</span>
<span class="n">librosa</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">specshow</span><span class="p">(</span><span class="n">S_dB</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">music</span><span class="p">[</span><span class="s1">&#39;fs_Hz&#39;</span><span class="p">],</span> <span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">y_axis</span><span class="o">=</span><span class="s1">&#39;hz&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">bwr</span><span class="p">)</span>
<span class="n">freqLine1</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T_samples</span><span class="p">],[</span><span class="n">f1_Hz</span><span class="p">,</span> <span class="n">f1_Hz</span><span class="p">],</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;f1_Hz=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f1_Hz</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
<span class="n">freqLine2</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T_samples</span><span class="p">],[</span><span class="n">f2_Hz</span><span class="p">,</span> <span class="n">f2_Hz</span><span class="p">],</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;f2_Hz=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f2_Hz</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
<span class="n">freqLine3</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">T_samples</span><span class="p">],[</span><span class="n">f3_Hz</span><span class="p">,</span> <span class="n">f3_Hz</span><span class="p">],</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;f3_Hz=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f3_Hz</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Hz&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Spektrogramm des Musiksignals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Zeit [s]&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequenz [Hz]&#39;</span><span class="p">)</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1500</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">freqLine1</span><span class="p">,</span> <span class="n">freqLine2</span><span class="p">,</span> <span class="n">freqLine3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Im Spektrogramm sind z.B. die Frequenzanteile um $700$ Hz, $950$ Hz, $1050$ Hz deutlich zu sehen, die zu den exakten Tonhöhen $ F_{5} = 698.46$ Hz, $ B^b_{5} = 932.33$ Hz und $ C_{6}=1046.50$ Hz korrespondieren. Weitere Beziehungen zwischen Tonhöhen und Frequenzen sind in der Tabelle unter Referenz [7] zu finden.</p>
<a class="reference internal image-reference" href="../_images/1-note.png"><img alt="../_images/1-note.png" src="../_images/1-note.png" style="width: 900px;" /></a>
<hr class="docutils" />
<br>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h3>
<ol class="simple">
<li><p>Titelbild von <a class="reference external" href="https://de.wikipedia.org/wiki/Kurzzeit-Fourier-Transformation#/media/Datei:Short_time_fourier_transform.PNG">Ethan Weil</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Short-time_Fourier_transform">Short-time Fourier transform</a></p></li>
<li><p>Lehrbuch: <a class="reference external" href="https://katalog.slub-dresden.de/id/0-1654371521/#detail">Intelligente Signalverarbeitung 1 - Signalanalyse</a></p></li>
<li><p>Vedio: <a class="reference external" href="https://www.youtube.com/watch?v=g1_wcbGUcDY">The Short Time Fourier Transform | Digital Signal Processing</a></p></li>
<li><p><a class="reference external" href="https://pages.mtu.edu/~suits/MissingFund.html">The Missing Fundamental</a></p></li>
<li><p><a class="reference external" href="https://towardsdatascience.com/extract-features-of-music-75a3f9bc265d">Music Feature Extraction in Python</a></p></li>
<li><p><a class="reference external" href="https://pages.mtu.edu/~suits/notefreqs.html">Frequencies for equal-tempered scale</a></p></li>
<li><p>Referenz von Colormap: <a class="reference external" href="https://matplotlib.org/3.1.1/gallery/color/colormap_reference.html">matplotlib.cm</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=RgKAFK5djSk">Wiz Khalifa - See You Again ft. Charlie Puth</a></p></li>
</ol>
<hr class="docutils" />
<div>Notebook erstellt von Arne-Lukas Fietkau, Yifei Li  und <a href="mailto:christoph.wagner@tu-dresden.de?Subject=Frage%20zu%20Jupyter%20Notebook%203.1%20STFT" target="_top">Christoph Wagner</a></div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "Berni96/tud-sv",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Thema-3-Analyse nichtstationärer Signale"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../Thema-2-Messung%20der%20%C3%9Cbertragungsfunktion/2.2%20-%20LPC.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">2.2 - Linear Predictive Coding</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By SHK<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>